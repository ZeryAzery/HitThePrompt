		## Conf de base ##


enable
conf t
hostname S1
line console 0
password cisco
login
exit
ena sec class
service password-encryption
no ip domain-lookup 
no cdp run 
banner motd "This is a secure system. Authorized Access Only!"
exit
wr 	

sh clo
clo se 13:37:00 14 MARCH 2025

------------------------------------------------------------------------------------------



"do" avant la commande permet d'ex√©cuter une commande sans faire exit
wr=copy running-config startup-config ?
no cdp run  		> protocole Cisco qui permet aux √©quipements r√©seau d‚Äô√©changer des infos sur leurs voisins
no ip domain-lookup 	> √©vite recherche DNS en cas d'erreur de frappe



------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------

		### interface routeur/switch ###


int g0/0
ip ad 10.1.1.1 255.255.255.0
desc LAN to S2
no sh
exit
ex
wr

sh ru


------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------

			### üèÅ ROUTAGE üèÅ ###


‚Ä¢ Configurer une route statique
	ip route 10.1.1.0 255.255.255.0 g0/2 (nom interface ou adresse IP interface ?)
‚Ä¢ Afficher les routes statiques
	do show running-config | include ^ip route

‚Ä¢ Routage RIPv2
	router rip
	version 2
	no auto-summary
	network 192.168.0.0
	network 209.165.200.224
	exit
‚Ä¢ Afficher les routes rip
	show ip route rip



------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------

			### üöß VLAN üöß ###


vlan 10 
name EMPLOYES 
vlan 20 
name ETUDIANTS 
vlan 30 
name INVITES 
vlan 99 
name MANAGEMENT 
 

	‚Ä¢ MODE ACCESS üõµ (Le port en mode access laisse passer le traffic d'un VLAN)
	--------------

int fa 0/11
switchport access vlan 10

int fa 0/18
sw ac vl 20

int range Gi 0/1-2
switchport mode trunk
switchport trunk native vlan 99

sh vl br

VLAN NATIF:
int ra g0/1‚Äì2
switchport trunk native vlan 84 (sw tr na vl 84)
sh ru

***Le VLAN 1 appara√Ætra tjrs sur les interfaces non tagu√©es***
Le VLAN 1 (natif) est souvent d√©plac√© pour des raisons de s√©curit√© (il n'a pas de trame 802.1Q)



	‚Ä¢ MODE TRUNK üèçÔ∏è (Le port Trunk laisse passer le traffic de plusieurs VLANs)
	-------------

   -> SWITCH ( -> sur le port connect√© au routeur ! ):

int ra g0/1-2
switchport mode trunk 			(sw mo tr)
switchport trunk allowed vlan 10,20,30	(sw tr al vl 10,20,30) 
ex
ex
wr

***Le protocole DTP n√©gocie automatiquement l'autre c√¥t√© des liens trunk.***
show interface trunk (sh int tr)


   -> ROUTEUR (sur l'interface reli√©e au switch):

int g0/0.10
encapsulation dot1Q 10
ip ad 192.168.10.1 255.255.255.0

int g0/0.20
encapsulation dot1Q 20
ip ad 192.168.20.1 255.255.255.0


do sh vl
do sh in tr

Pour faire passer le service DHCP entre les vlans faire (si le serveur dhcp est en 192.168.20.11) :
interface g0/0/1.10
ip helper-address 192.168.20.11


‚ö†Ô∏è Pour adresser une IP sur une interface physique quand un routeur avec le vlan 1 (natif) est √©teint (car ce sont les SVIs portent les adresses)
il faut utiliser la commande "no switchport" sur l'interface sur laquelle on souhaite adresser une IP.



-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------


		‚§¥Ô∏è ## LACP ## ‚§¥Ô∏è


Aggr√©gation de liens (EtherChannel) 

‚Ä¢ PAgP > protocole Cisco EtherChannel
‚Ä¢ LACP > version standard ouverte d‚ÄôEtherChannel (IEEE - 802.3ad)

‚Ä¢ Travailler sur les liens √©teints pour √©viter ¬´ err-disabled ¬ª 

SWITCH-1
int ra fa0/3-4
shutdown
channel-group 2 mode active (LACP)
no sh
int port-channel 2
sw tr enc dot1q -----------> (sur les switchs L3 faire l'encap pour pouvoir passer en trunk)
switchport mode trunk
do wr

SWITCH-2
int ra fa0/3-4
shutdown
channel-group 2 mode desirable (PAgP)
no sh
int port-channel 2
switchport mode trunk
do wr

SWITCH-3
int ra fa0/3-4
shutdown
channel-group 2 mode on (?)
no sh
int port-channel 2
switchport mode trunk
do wr


V√©rifier le fonctionnement de Port Channel 2
do sh eth sum

D√©finir S1 en pont racine Spanning-Tree
spanning-tree vlan 1 root primary 



-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------



		## VTP ##


Pour que les swiths r√©cup√®rent les infos vlans


‚Ä¢ Switch serveur
 ---------------
en
conf t
vtp mode server
vtp domain ?
vtp domain AIS.LAB
vtp domain password AIS
vtp version 2

vlan 10
name vlan10

VLAN 20
name vlan20

etc......



‚Ä¢ Switch client
 --------------
en
conf t
vtp mode client
vtp domain AIS.LAB
vtp password AIS

Si un switch ne prend pas les VLANs avec le vtp faire un delete vlan.dat


-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------



		## Routage Inter-VLANs ##


‚Ä¢ Switch client
 --------------

int f0/1
sw mo ac
sw ac vl 10
sw voice vlan 40

int f0/2
sw mo ac
sw ac vl 20
sw voice vlan 40
do wr


‚Ä¢ Switch L3 serveur (Une SVI par vlan)
 ------------------


in vl 10
ip ad 10.10.0.1 255.255.255.0

in vl 20
ip ad 10.20.0.1 255.255.255.0

in vl 30
ip ad 10.30.0.1 255.255.255.0

in vl 40
ip ad 10.40.0.1 255.255.255.0

ip routing (pour switch L3)


-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------



		## ‚õî Spanning Tree Protocol ‚õî ##


Les trames du STP sont appel√©es BPDU (Bridge Protocol Data Unit) et sont envoy√©es aux autres switchs
Ce protocole emp√™che les boucles de broadcast qui peuvent cr√©er des temp√™tes
Il faut √©lire un "Pont Racine" (Switch ma√Ætre)


‚Ä¢ Configuration du port racine
spanning-tree vlan 1,10,20,30,40 root primary
# ou
spanning-tree vlan 1 priority 24576 ( entre 0 et 61440 )

show spanning-tree

‚Ä¢ Config port fast
int f0/1
spanning-tree portfast (√† faire sur les endpoints seulements) 

‚Ä¢ Configuration via la priorit√©
spanning-tree bpduguard enable


-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------



		## DHCP ##


‚Ä¢ Serveur DHCP
```
ip dhcp pool Client-VLAN110
network 10.10.0.0 255.255.255.0
dns-server 8.8.8.8
default routeur 10.10.0.1
```
‚Ä¢ Exclusion DHCP
```
ipdhcp excluded-address[1rst address] [last address]
```
‚Ä¢ Relais DHCP
```
int vl 10
ip helper-address 10.0.0.1 (adresse du DHCP...)
```

-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------



		## OSPF ##


Protocole de routage dynamique
d√©clarer mask en wildcard (ici 255.255.255.252 = 0.0.0.3 ( /30 )



√Ä d√©clarer sur chaque routeur d'une m√™me zone (ou area 0 est une zone d√©finie):
```
en
conf t
router ospf 1
network 192.168.35.0 0.0.0.255 area 0
network 192.168.36.0 0.0.0.255 area 0
network 192.168.37.0 0.0.0.255 area 0
network 192.168.38.0 0.0.0.255 area 0
do wr
```


Pour v√©rifier :
```
show ip ospf
show ip ospf neighbor
show ip route ospf
```


```
Passive-interface g0/0
```

Passive-interface : 
* Permet d'√©viter du trafic OSPF inutile, √† faire uniquement sur une interface de routeur non connect√©e directement √† un routeur participant au processus OSPF
* Dans l'exemple du dessus si l'interface g0/0 est connect√©e √† un LAN le traffic OSPF ne sera pas redistribu√© inutilement vers le LAN



Redistribution des routes OSPF vers BGP
```
router bgp 100
redistribute ospf 1
```

le `1` correspond √† l'Id du process OSF souhait√©



-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------


		 ## üö¢ BGP üö¢ ## 

AS = Autonomous System (forme un ensemble de routeurs pour un m√™me AS)
Ce num√©ro identifie un r√©seau BGP.

Puis indiquer l'IP du routeur de l'autre cot√© et son as
Puis indiquer les r√©seau voisin du routeur


Routeur 1
```
router bgp 100 
neighbor 192.168.41.253 remote-as 300  
network 192.168.13.0 
network 192.168.15.0 
network 192.168.16.0
```


Routeur 2
```
router bgp 300 
neighbor 192.168.41.254 remote-as 100  
network 192.168.35.0 
network 192.168.38.0 
network 192.168.32.0
do wr



Pour v√©rifier :
```
show ip bgp 
```

Redistribution des routes BGP vers OSPF
```
router ospf 1
redistribute bgp 100 subnets
```

-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------



		## NAT ##


NAT DYNAIQUE AVEC SURCHARGE

ip nat outside
ip nat inside 
acecess-list 1 permit  172.16.0.128 0.0.0.15
ip nat inside source list 1 interface f0/1 overload


PORT FORWARDING (D-NAT)

ip nat outside
ip nat inside 
acces-list 2 permit tcp any any eq 80
ip nat inside source static tcp 192.168.10.1 80 9.9.9.34 80

show ip nat translation


-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------



		## HSRP ## 

Protocole de redondance et de clustering 
Le HSRP permet de faire apparaitre pour l'utilisateur une seule passerelle alors qu'il y au moins deux routeurs (ou plus)
qui servent de backup. La priorit√© la plus haute d√©finit le routeur actif.

hsrp ‚Üí version cisco
vrrp ‚Üí version ouverte / stormshield
carp ‚Üí pfsense ?
fgcp ‚Üí Fortinet


‚Ä¢ Active  ‚Üí routeur qui g√®re le trafic (celui avec la plus haute priorit√©).
‚Ä¢ Standby ‚Üí routeur pr√™t √† prendre le relais imm√©diatement si l‚Äôactif tombe.
‚Ä¢ Listen  ‚Üí les autres routeurs du groupe HSRP (s‚Äôil y en a plus de deux). Ils √©coutent les messages HSRP mais ne sont ni actifs ni standby.


‚Ä¢ "preempt" permet de redevenir actif si le routeur reprend le dessus.





# Exemple pour 3 routeurs :


‚Ä¢ Routeur 1 (actif pour LAN interne)

interface GigabitEthernet0/0/0
 ip address 172.30.128.1 255.255.255.0
 standby 1 ip 172.30.128.254
 standby 1 priority 120
 standby 1 preempt
 standby 1 description HSRP-LAN
 no shutdown


‚Ä¢ Routeur 2 (standby)

interface GigabitEthernet0/0/0
 ip address 172.30.128.2 255.255.255.0
 standby 1 ip 172.30.128.254
 standby 1 priority 110
 standby 1 preempt
 standby 1 description HSRP-LAN
 no shutdown


‚Ä¢ Routeur 3 (stanby / en √©coute / backup)

interface GigabitEthernet0/0/0
 ip address 172.30.128.3 255.255.255.0
 standby 1 ip 172.30.128.254
 standby 1 priority 100
 standby 1 preempt
 standby 1 description HSRP-LAN
 no shutdown


V√©rifier si HSRP est bien activ√©

show standby
show standby brief



-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------


		## QoS ##



Lancer une connexion ftp
```
ftp 172.20.0.2 # (user : cisco, password : cisco)
```


T√©l√©charger le fichier binaire
```
get c1841-advipservicesk9-mz.124-15.T1.bin
```

V√©rifier une vitesse de transfert
```
show interfaces fa 0/1
```

D√©clarer les classes de flux
```
conf t
class-map match-all prio-sur-interface
match input-interface fa1/0
ex
```


V√©rifier la d√©claration de la classe
```
show class-map
```


D√©clarer une politique de QoS
```
conf t
policy-map ma-politique-qos
class prio-sur-interface
set ip dscp cs7
ex
ex
```
le code "cs7", √©quivalent √† un DSCP de "111000" et donc une priorit√© haute de "7"



5 minute input rate 1525 bits/sec, 36 packets/sec 
5 minute output rate 493 bits/sec, 11 packets/sec

-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------


		##  üîß Commandes de r√©initialisation üîß ##


‚Ä¢ Mode usine switch/routeur:
	erase startup-config

‚Ä¢ Mode usine switch/routeur: (ne sais pas la diff&rence)
	write erase

‚Ä¢ R√©initialiser une interface:
	default int gi 0/1

‚Ä¢ Supprimmer un VLAN
	no vlan 10

‚Ä¢ Supprimer toutes les VLANs
	delete vlan.dat

‚Ä¢ Supprimer adresse interface
	in g0/0
	no ip address

‚Ä¢ Supprimer une route
	no ip route 192.168.11.0 255.255.255.0 209.165.200.225

‚Ä¢ Supprimer toutes les routes (‚ö†Ô∏èStatic et dynamique)
	clear ip route * fonctionne pas...

Pour supprimer compl√®tement le STP il faut le supprimer sur tout les VLANs (m√™me le VLAN 1)
‚Ä¢ D√©sactiver STP sur tout le switch
	no spanning-tree mode 

‚Ä¢ D√©sactiver STP sur un VLAN
	no spanning-tree vlan <ID_VLAN>

‚Ä¢ d√©sactiver un port channel
no int po 2



-----------------------------------------------------------------------------------------------
Trunk couche de nv 2
Routage couche de nv3